{"version":3,"sources":["matrix-2d.ts","vector-2d.ts","flipper.ts"],"names":[],"mappings":"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xB,MAAM,CAAC,IAAI,QAAQ,CAAC;YAChB,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;YAEnD,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;YAEnD,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC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","file":"flipper.js","sourcesContent":["function Matrix2D(elements) {\r\n\r\n    var self = this;\r\n\r\n    var m = elements || [1, 0, 0, 0, 1, 0, 0, 0, 1];\r\n\r\n    function determinant() {\r\n        var ax = m[0];\r\n        var ay = m[1];\r\n        var az = m[2];\r\n        var bx = m[3];\r\n        var by = m[4];\r\n        var bz = m[5];\r\n        var cx = m[6];\r\n        var cy = m[7];\r\n        var cz = m[8];\r\n\r\n        var dx = by * cz - bz * cy;\r\n        var dy = bz * cx - bx * cz;\r\n        var dz = bx * cy - by * cx;\r\n        return ax * dx + ay * dy + az * dz;\r\n    }\r\n\r\n    function transformVector(v) {\r\n        return [\r\n            v[0] * m[0] + v[1] * m[3] + m[6],\r\n            v[0] * m[1] + v[1] * m[4] + m[7]\r\n        ];\r\n    }\r\n\r\n    function transformBox(box) {\r\n        var xmin = box.left;\r\n        var ymin = box.top;\r\n        var xmax = box.left + box.width;\r\n        var ymax = box.top + box.height;\r\n        var tl = transformVector([xmin, ymin]),\r\n            tr = transformVector([xmax, ymin]),\r\n            bl = transformVector([xmin, ymax]),\r\n            br = transformVector([xmax, ymax]);\r\n        var y1 = Math.max(tl[1], tr[1], bl[1], br[1]);\r\n        var y0 = Math.min(tl[1], tr[1], bl[1], br[1]);\r\n        var x1 = Math.max(tl[0], tr[0], bl[0], br[0]);\r\n        var x0 = Math.min(tl[0], tr[0], bl[0], br[0]);\r\n        return {\r\n            top: y0,\r\n            bottom: y1,\r\n            left: x0,\r\n            right: x1,\r\n            width: x1 - x0,\r\n            height: y1 - y0\r\n        };\r\n    }\r\n\r\n    function multiplyArray(other) {\r\n        return new Matrix2D([\r\n            m[0] * other[0] + m[1] * other[3] + m[2] * other[6],\r\n            m[0] * other[1] + m[1] * other[4] + m[2] * other[7],\r\n            m[0] * other[2] + m[1] * other[5] + m[2] * other[8],\r\n\r\n            m[3] * other[0] + m[4] * other[3] + m[5] * other[6],\r\n            m[3] * other[1] + m[4] * other[4] + m[5] * other[7],\r\n            m[3] * other[2] + m[4] * other[5] + m[5] * other[8],\r\n\r\n            m[6] * other[0] + m[7] * other[3] + m[8] * other[6],\r\n            m[6] * other[1] + m[7] * other[4] + m[8] * other[7],\r\n            m[6] * other[2] + m[7] * other[5] + m[8] * other[8]\r\n        ]);\r\n    }\r\n\r\n    function multiply(other) {\r\n        return multiplyArray(other.getElements());\r\n    }\r\n\r\n    function translate(vector) {\r\n        return multiplyArray([1, 0, 0, 0, 1, 0, vector.x, vector.y, 1]);\r\n    }\r\n\r\n    function scale(kx, ky) {\r\n        return multiplyArray([kx, 0, 0, 0, ky, 0, 0, 0, 1]);\r\n    }\r\n\r\n    function rotate(deg) {\r\n        var angle = deg * Math.PI / 180;\r\n        var ca = Math.cos(angle);\r\n        var sa = Math.sin(angle);\r\n        return multiplyArray([ca, sa, 0, -sa, ca, 0, 0, 0, 1]);\r\n    }\r\n\r\n    function reverse() {\r\n        var det = determinant();\r\n\r\n        var ux = m[0];\r\n        var uy = m[3];\r\n        var uz = m[6];\r\n\r\n        var vx = m[1];\r\n        var vy = m[4];\r\n        var vz = m[7];\r\n\r\n        var wx = m[2];\r\n        var wy = m[5];\r\n        var wz = m[8];\r\n\r\n        var c11 = (vy * wz - wy * vz) / det;\r\n        var c12 = (wy * uz - uy * wz) / det;\r\n        var c13 = (uy * vz - vy * uz) / det;\r\n\r\n        var c21 = (wx * vz - vx * wz) / det;\r\n        var c22 = (ux * wz - wx * uz) / det;\r\n        var c23 = (vx * uz - ux * vz) / det;\r\n\r\n        var c31 = (vx * wy - wx * vy) / det;\r\n        var c32 = (wx * uy - ux * wy) / det;\r\n        var c33 = (ux * vy - vx * uy) / det;\r\n\r\n        return new Matrix2D([c11, c21, c31, c12, c22, c32, c13, c23, c33]);\r\n    }\r\n\r\n    function getElements() {\r\n        return m.slice(0);\r\n    }\r\n\r\n    function roundFloat(v) {\r\n        return Math.round(v * 1e8) / 1e8;\r\n    }\r\n\r\n    function getTransformExpression() {\r\n        return `matrix(${roundFloat(m[0])}, ${roundFloat(m[1])}, ${roundFloat(m[3])}, ${roundFloat(m[4])}, ${roundFloat(m[6])}, ${roundFloat(m[7])})`;\r\n    }\r\n\r\n    self.getElements = getElements;\r\n    self.getTransformExpression = getTransformExpression;\r\n    self.transformVector = transformVector;\r\n    self.transformBox = transformBox;\r\n    self.translate = translate;\r\n    self.scale = scale;\r\n    self.reverse = reverse;\r\n    self.rotate = rotate;\r\n    self.multiply = multiply;\r\n    self.determinant = determinant;\r\n}\r\n","function Vector2D(x, y) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    this.length = function () {\r\n        return Math.sqrt(this.x * this.x + this.y * this.y);\r\n    };\r\n\r\n    this.sub = function (other) {\r\n        return new Vector2D(this.x - other.x, this.y - other.y);\r\n    };\r\n\r\n    this.add = function (other) {\r\n        return new Vector2D(this.x + other.x, this.y + other.y);\r\n    };\r\n\r\n    this.mul = function (val) {\r\n        return new Vector2D(this.x * val, this.y * val);\r\n    };\r\n\r\n    this.rotateClockwise90 = function () {\r\n        return new Vector2D(this.y, -this.x);\r\n    };\r\n\r\n    this.rotateCounterClockwise90 = function () {\r\n        return new Vector2D(-this.y, this.x);\r\n    };\r\n\r\n    this.changeLength = function (val) {\r\n        var len = this.length();\r\n        if (!len) len = 1;\r\n        return this.mul(val / len);\r\n    };\r\n\r\n    this.normalize = function () {\r\n        return this.changeLength(1);\r\n    }\r\n\r\n}","///<reference path=\"matrix-2d.ts\" />\r\n///<reference path=\"vector-2d.ts\" />\r\n\r\ndeclare var $:any;\r\n\r\n$(document).ready(function () {\r\n\r\n    var $container = $('.page-turn');\r\n    var $scaler = $container.find('.scaler');\r\n\r\n    var touchCorner = 'right';\r\n\r\n    function calculateFold(stage) {\r\n        var screenHeight = $scaler.height();\r\n        var screenWidth = $scaler.width();\r\n\r\n        var pageWidth = screenWidth / 2;\r\n        var pageHeight = screenHeight;\r\n\r\n        stage = Math.min(1, stage);\r\n        stage = Math.max(0, stage);\r\n\r\n        var angle = 45 + 45 * stage; //symmetry line angle changes from 45 to 90.\r\n        angle = angle * Math.PI / 180;\r\n\r\n        var fx = stage * pageWidth;\r\n        var fy = 0;\r\n\r\n        var foldA = new Vector2D(fx, fy);\r\n\r\n        var dpl = fx * Math.cos(angle);\r\n        var dpx = dpl * Math.cos(angle);\r\n        var dpy = dpl * Math.sin(angle);\r\n\r\n        var p = new Vector2D(fx - dpx, dpy);\r\n\r\n        var pointA = p.mul(2);\r\n        var pointB = foldA.sub(pointA).rotateClockwise90().changeLength(pageHeight).add(pointA);\r\n        var pointC = pointA.sub(pointB).rotateClockwise90().changeLength(pageWidth).add(pointB);\r\n        var pointD = pointB.sub(pointC).rotateClockwise90().changeLength(pageHeight).add(pointC);\r\n        var pointE = new Vector2D(0, 0);\r\n\r\n        var foldB = pointB;\r\n        if (foldB.x < 0) {\r\n            var ba = pointA.sub(pointB).changeLength(pageHeight);\r\n            var k = -pointA.x / ba.x;\r\n            ba = ba.mul(k);\r\n            foldB = ba.add(pointA);\r\n        } else {\r\n            var side = pointC.sub(pointB);\r\n            var crossLineY = pageHeight - pointB.y;\r\n\r\n            if (side.y != 0) {\r\n                var k = crossLineY / side.y;\r\n                foldB = side.mul(k).add(pointB);\r\n            } else {\r\n                foldB = pointC;\r\n            }\r\n        }\r\n\r\n        return {\r\n            foldA: foldA,\r\n            foldB: foldB,\r\n            pointA: pointA,\r\n            pointB: pointB,\r\n            pointC: pointC,\r\n            pointD: pointD,\r\n            pointE: pointE\r\n        };\r\n    }\r\n\r\n    function getGlobalFold(fold) {\r\n        var screenHeight = $scaler.height();\r\n        var screenWidth = $scaler.width();\r\n\r\n        var pageWidth = screenWidth / 2;\r\n        var pageHeight = screenHeight;\r\n\r\n        function toGlobal(vector) {\r\n            if (touchCorner == 'right') {\r\n                return new Vector2D(screenWidth - vector.x, screenHeight - vector.y);\r\n            } else if (touchCorner == 'left') {\r\n                return new Vector2D(vector.x, screenHeight - vector.y);\r\n            }\r\n        }\r\n\r\n        return {\r\n            foldA: toGlobal(fold.foldA),\r\n            foldB: toGlobal(fold.foldB),\r\n            pointA: toGlobal(fold.pointA),\r\n            pointB: toGlobal(fold.pointB),\r\n            pointC: toGlobal(fold.pointC),\r\n            pointD: toGlobal(fold.pointD),\r\n            pointE: toGlobal(fold.pointE)\r\n        };\r\n    }\r\n\r\n    function dumpFold(globalFold) {\r\n        var screenHeight = $scaler.height();\r\n        var screenWidth = $scaler.width();\r\n\r\n        function debugPoint($point, vector) {\r\n            $point.css({\r\n                left: (100 * vector.x / screenWidth) + '%',\r\n                top: (100 * vector.y / screenHeight) + '%'\r\n            })\r\n        }\r\n\r\n        debugPoint($('.fold-point-A'), globalFold.foldA);\r\n        debugPoint($('.fold-point-B'), globalFold.foldB);\r\n        debugPoint($('.point-a'), globalFold.pointA);\r\n        debugPoint($('.point-b'), globalFold.pointB);\r\n        debugPoint($('.point-c'), globalFold.pointC);\r\n        debugPoint($('.point-d'), globalFold.pointD);\r\n        debugPoint($('.point-e'), globalFold.pointE);\r\n    }\r\n\r\n    function getOuterClipMatrix(pointO, pointU, pointV, originalWidth, originalHeight) {\r\n        var width = pointU.sub(pointO).length();\r\n        var height = pointV.sub(pointO).length();\r\n        var clipX = pointU.sub(pointO).changeLength(width / originalWidth);\r\n        var clipY = pointV.sub(pointO).changeLength(height / originalHeight);\r\n        return new Matrix2D([clipX.x, clipX.y, 0, clipY.x, clipY.y, 0, 0, 0, 1]).translate(pointO);\r\n    }\r\n\r\n    function setupPage($page, matrix, clipperMatrix) {\r\n        $page.css({\r\n            transform: clipperMatrix.getTransformExpression()\r\n        })\r\n\r\n        matrix = matrix.multiply(clipperMatrix.reverse());\r\n\r\n        $page.find('img').css({\r\n            transform: matrix.getTransformExpression()\r\n        })\r\n    }\r\n\r\n    function getPageMatrix(globalFold) {\r\n        if (touchCorner == 'right') {\r\n            var page3XAxis = globalFold.pointC.sub(globalFold.pointB).normalize();\r\n            var page3YAxis = globalFold.pointA.sub(globalFold.pointB).normalize();\r\n            return new Matrix2D([page3XAxis.x, page3XAxis.y, 0, page3YAxis.x, page3YAxis.y, 0, 0, 0, 1]).translate(globalFold.pointB);\r\n        } else if (touchCorner == 'left') {\r\n            var page3XAxis = globalFold.pointB.sub(globalFold.pointC).normalize();\r\n            var page3YAxis = globalFold.pointD.sub(globalFold.pointC).normalize();\r\n            return new Matrix2D([page3XAxis.x, page3XAxis.y, 0, page3YAxis.x, page3YAxis.y, 0, 0, 0, 1]).translate(globalFold.pointC);\r\n        }\r\n    }\r\n\r\n    function refresh() {\r\n        var $slider = $('.page-turn .scaler');\r\n\r\n        var screenHeight = $slider.height();\r\n        var screenWidth = $slider.width();\r\n\r\n        var pageWidth = screenWidth / 2;\r\n        var pageHeight = screenHeight;\r\n\r\n        var stage = 1 - $('input#fold').val() / 100; //changes from 0 to 1\r\n\r\n        var localFold = calculateFold(stage);\r\n        var globalFold = getGlobalFold(localFold);\r\n\r\n        dumpFold(globalFold);\r\n\r\n        var pageMatrix = getPageMatrix(globalFold);\r\n\r\n        var clipperMatrix = getOuterClipMatrix(globalFold.foldA, globalFold.pointA, globalFold.foldB, pageWidth, pageHeight);\r\n\r\n        var clipper2Matrix = getOuterClipMatrix(globalFold.foldA, globalFold.pointE, globalFold.foldB, pageWidth, pageHeight);\r\n        if (touchCorner == 'right') {\r\n            var page4Matrix = new Matrix2D().translate(new Vector2D(pageWidth, 0));\r\n            setupPage($('.page3'), pageMatrix, clipperMatrix);\r\n            setupPage($('.page4'), page4Matrix, clipper2Matrix);\r\n        } else if (touchCorner == 'left') {\r\n            var page1Matrix = new Matrix2D().translate(new Vector2D(0, 0));\r\n\r\n            setupPage($('.page2'), pageMatrix, clipperMatrix);\r\n            setupPage($('.page1'), page1Matrix, clipper2Matrix);\r\n        }\r\n    }\r\n\r\n    function cleanPages() {\r\n        return $container.find('li').removeClass('page1 page2 page3 page4')\r\n    }\r\n\r\n    function clean() {\r\n        $container.removeClass('active').find('li').css('transform', '').find('img').css('transform', '');\r\n    }\r\n\r\n    function shiftCurrent(delta) {\r\n        var $current = $container.find('li.current');\r\n        var $node = $current;\r\n        while (delta) {\r\n            if (delta > 0) {\r\n                $node = $node.next('li');\r\n                delta--;\r\n            } else if (delta < 0) {\r\n                $node = $node.prev('li');\r\n                delta++;\r\n            }\r\n        }\r\n        if ($node.length) {\r\n            $current.removeClass('current');\r\n            $node.addClass('current');\r\n            return $node;\r\n        }\r\n        return $current;\r\n    }\r\n\r\n    function animate(corner, delta) {\r\n        touchCorner = corner;\r\n\r\n        clean();\r\n        $container.addClass('active').toggleClass('active-next', delta > 0).toggleClass('active-prev', delta < 0);\r\n\r\n        var frame = 100;\r\n\r\n        function draw() {\r\n            requestAnimationFrame(function () {\r\n                //if (frame == 40) return;\r\n\r\n                if (frame >= 4) {\r\n                    frame -= 4;\r\n                    $('input#fold').val(frame);\r\n                    draw();\r\n                } else {\r\n                    cleanPages();\r\n                    clean();\r\n                    shiftCurrent(delta);\r\n                }\r\n                refresh();\r\n            });\r\n        }\r\n\r\n        draw();\r\n    }\r\n    function animateForward() {\r\n        cleanPages();\r\n        $container.find('li.current').addClass('page1').next('li').addClass('page2').next('li').addClass('page3').next('li').addClass('page4');\r\n        animate('right', 2);\r\n    }\r\n\r\n    function animateBackward() {\r\n        cleanPages();\r\n        $container.find('li.current').next('li').addClass('page4').prev('li').addClass('page3').prev('li').addClass('page2').prev('li').addClass('page1');\r\n        animate('left', -2);\r\n    }\r\n\r\n    $('input#fold').bind('input', function () {\r\n        touchCorner = 'left';\r\n        clean();\r\n        $container.addClass('active');\r\n        var $current = $container.find('li.current');\r\n        $container.find('li.current').next('li').addClass('page4').prev('li').addClass('page3').prev('li').addClass('page2').prev('li').addClass('page1');\r\n        refresh();\r\n    });\r\n\r\n    $('button.forward').click(animateForward);\r\n    $('button.backward').click(animateBackward);\r\n\r\n    refresh();\r\n\r\n});"],"sourceRoot":"/source/"}