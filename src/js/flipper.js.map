{"version":3,"sources":["matrix-2d.ts","vector-2d.ts","fold.ts","flipper.ts"],"names":[],"mappings":"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","file":"flipper.js","sourcesContent":["class Matrix2D {\r\n\r\n    private m: number[];\r\n\r\n    constructor(elements?: number[]) {\r\n        this.m = elements || [1, 0, 0, 0, 1, 0, 0, 0, 1];\r\n    }\r\n\r\n    public transformVector(v: Vector2D) : Vector2D {\r\n        return new Vector2D(\r\n            v.x * this.m[0] + v.y * this.m[3] + this.m[6],\r\n            v.x * this.m[1] + v.y * this.m[4] + this.m[7]\r\n        );\r\n    }\r\n\r\n    public determinant() {\r\n        var ax = this.m[0];\r\n        var ay = this.m[1];\r\n        var az = this.m[2];\r\n        var bx = this.m[3];\r\n        var by = this.m[4];\r\n        var bz = this.m[5];\r\n        var cx = this.m[6];\r\n        var cy = this.m[7];\r\n        var cz = this.m[8];\r\n\r\n        var dx = by * cz - bz * cy;\r\n        var dy = bz * cx - bx * cz;\r\n        var dz = bx * cy - by * cx;\r\n        return ax * dx + ay * dy + az * dz;\r\n    }\r\n\r\n    private multiplyArray(other: number[]) {\r\n        return new Matrix2D([\r\n            this.m[0] * other[0] + this.m[1] * other[3] + this.m[2] * other[6],\r\n            this.m[0] * other[1] + this.m[1] * other[4] + this.m[2] * other[7],\r\n            this.m[0] * other[2] + this.m[1] * other[5] + this.m[2] * other[8],\r\n\r\n            this.m[3] * other[0] + this.m[4] * other[3] + this.m[5] * other[6],\r\n            this.m[3] * other[1] + this.m[4] * other[4] + this.m[5] * other[7],\r\n            this.m[3] * other[2] + this.m[4] * other[5] + this.m[5] * other[8],\r\n\r\n            this.m[6] * other[0] + this.m[7] * other[3] + this.m[8] * other[6],\r\n            this.m[6] * other[1] + this.m[7] * other[4] + this.m[8] * other[7],\r\n            this.m[6] * other[2] + this.m[7] * other[5] + this.m[8] * other[8]\r\n        ]);\r\n    }\r\n\r\n    public multiply(other: Matrix2D): Matrix2D {\r\n        return this.multiplyArray(other.getElements());\r\n    }\r\n\r\n    public translate(vector: Vector2D): Matrix2D {\r\n        return this.multiplyArray([1, 0, 0, 0, 1, 0, vector.x, vector.y, 1]);\r\n    }\r\n\r\n    public scale(kx: number, ky: number): Matrix2D {\r\n        return this.multiplyArray([kx, 0, 0, 0, ky, 0, 0, 0, 1]);\r\n    }\r\n\r\n    public rotate(deg: number): Matrix2D {\r\n        var angle = deg * Math.PI / 180;\r\n        var ca = Math.cos(angle);\r\n        var sa = Math.sin(angle);\r\n        return this.multiplyArray([ca, sa, 0, -sa, ca, 0, 0, 0, 1]);\r\n    }\r\n\r\n    public reverse(): Matrix2D {\r\n        var det = this.determinant();\r\n\r\n        var ux = this.m[0];\r\n        var uy = this.m[3];\r\n        var uz = this.m[6];\r\n\r\n        var vx = this.m[1];\r\n        var vy = this.m[4];\r\n        var vz = this.m[7];\r\n\r\n        var wx = this.m[2];\r\n        var wy = this.m[5];\r\n        var wz = this.m[8];\r\n\r\n        var c11 = (vy * wz - wy * vz) / det;\r\n        var c12 = (wy * uz - uy * wz) / det;\r\n        var c13 = (uy * vz - vy * uz) / det;\r\n\r\n        var c21 = (wx * vz - vx * wz) / det;\r\n        var c22 = (ux * wz - wx * uz) / det;\r\n        var c23 = (vx * uz - ux * vz) / det;\r\n\r\n        var c31 = (vx * wy - wx * vy) / det;\r\n        var c32 = (wx * uy - ux * wy) / det;\r\n        var c33 = (ux * vy - vx * uy) / det;\r\n\r\n        return new Matrix2D([c11, c21, c31, c12, c22, c32, c13, c23, c33]);\r\n    }\r\n\r\n    public getElements() {\r\n        return this.m.slice(0);\r\n    }\r\n\r\n    private roundFloat(v) {\r\n        return Math.round(v * 1e8) / 1e8;\r\n    }\r\n\r\n    public getTransformExpression() {\r\n        return `matrix(${this.roundFloat(this.m[0])}, ${this.roundFloat(this.m[1])}, ${this.roundFloat(this.m[3])}, ${this.roundFloat(this.m[4])}, ${this.roundFloat(this.m[6])}, ${this.roundFloat(this.m[7])})`;\r\n    }\r\n\r\n}\r\n","class Vector2D {\r\n\r\n    public x: number;\r\n    public y: number;\r\n\r\n    constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n\r\n    public length() {\r\n        return Math.sqrt(this.x * this.x + this.y * this.y);\r\n    };\r\n\r\n    public sub(other: Vector2D) {\r\n        return new Vector2D(this.x - other.x, this.y - other.y);\r\n    };\r\n\r\n    public add(other: Vector2D) {\r\n        return new Vector2D(this.x + other.x, this.y + other.y);\r\n    };\r\n\r\n    public mul(val: number) {\r\n        return new Vector2D(this.x * val, this.y * val);\r\n    };\r\n\r\n    public rotateClockwise90() {\r\n        return new Vector2D(this.y, -this.x);\r\n    };\r\n\r\n    public rotateCounterClockwise90() {\r\n        return new Vector2D(-this.y, this.x);\r\n    };\r\n\r\n    public changeLength(val: number) {\r\n        var len = this.length();\r\n        if (!len) len = 1;\r\n        return this.mul(val / len);\r\n    };\r\n\r\n    public normalize() {\r\n        return this.changeLength(1);\r\n    }\r\n\r\n    public toString() {\r\n        return `{${this.x}, ${this.y}}`;\r\n    };\r\n\r\n}","///<reference path=\"vector-2d.ts\" />\r\n\r\ninterface IFold {\r\n\r\n    foldA: Vector2D;\r\n\r\n    foldB: Vector2D;\r\n\r\n\r\n    /**\r\n     * Touch corner position\r\n     */\r\n    pointA: Vector2D;\r\n\r\n    pointB: Vector2D;\r\n\r\n    pointC: Vector2D;\r\n\r\n    pointD: Vector2D;\r\n    \r\n    pointE: Vector2D;\r\n    \r\n}","///<reference path=\"matrix-2d.ts\" />\r\n///<reference path=\"vector-2d.ts\" />\r\n///<reference path=\"fold.ts\" />\r\n///<reference path=\"jquery.d.ts\" />\r\n\r\n$(document).ready(function () {\r\n\r\n    var $container = $('.page-turn');\r\n    var $scaler = $container.find('.scaler');\r\n\r\n    var $frontPage: IJQueryNodes;\r\n    var $backPage: IJQueryNodes;\r\n    var $frontPageImg: IJQueryNodes;\r\n    var $backPageImg: IJQueryNodes;\r\n\r\n\r\n    var touchPointA: Vector2D;\r\n    var touchCorner = '';\r\n    var touchDelta = 0;\r\n\r\n    var globalToLocalMatrix: Matrix2D;\r\n    var localToGlobalMatrix: Matrix2D;\r\n    var localToTextureMatrix: Matrix2D;\r\n    var textureToLocalMatrix: Matrix2D;\r\n\r\n    var screenHeight = $scaler.height();\r\n    var screenWidth = $scaler.width();\r\n    var pageHeight = screenHeight;\r\n    var pageWidth = screenWidth / 2;\r\n\r\n    /**\r\n     * Get corner type by jquery node\r\n     */\r\n    function getCornerType($corner: IJQueryNodes): string {\r\n        if ($corner.hasClass('corner-br')) {\r\n            return 'br';\r\n        } else if ($corner.hasClass('corner-bl')) {\r\n            return 'bl';\r\n        } else if ($corner.hasClass('corner-tr')) {\r\n            return 'tr';\r\n        } else if ($corner.hasClass('corner-tl')) {\r\n            return 'tl';\r\n        } else {\r\n            return '';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get global to corner local coordinate system transformation matrix\r\n     */\r\n    function getCornerMatrix(corner: string): Matrix2D {\r\n        var m = new Matrix2D();\r\n        switch (corner) {\r\n            case 'br':\r\n                return m.translate(new Vector2D(-screenWidth, -screenHeight)).scale(-1, -1);\r\n            case 'bl':\r\n                return m.translate(new Vector2D(0, -screenHeight)).scale(1, -1);\r\n            case 'tr':\r\n                return m.translate(new Vector2D(-screenWidth, 0)).scale(-1, 1);\r\n            case 'tl':\r\n                return m.translate(new Vector2D(0, 0)).scale(1, 1);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    function getCornerShift(corner: string): number {\r\n        switch (corner) {\r\n            case 'br':\r\n            case 'tr':\r\n                return 2;\r\n            case 'bl':\r\n            case 'tl':\r\n                return -2;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * Get local to texture transform matrix\r\n     */\r\n    function getTextureMatrix(corner: string): Matrix2D {\r\n        var m = new Matrix2D();\r\n        switch (corner) {\r\n            case 'br':\r\n                return m.scale(1, -1).translate(new Vector2D(0, pageHeight));\r\n            case 'tr':\r\n                return m.scale(1, 1).translate(new Vector2D(0, 0));\r\n            case 'bl':\r\n                return m.scale(-1, -1).translate(new Vector2D(pageWidth, pageHeight));\r\n            case 'tl':\r\n                return m.scale(-1, 1).translate(new Vector2D(pageWidth, 0));\r\n        }\r\n    }\r\n\r\n    function getFrontPage(corner: string): IJQueryNodes {\r\n        switch (corner) {\r\n            case 'br':\r\n            case 'tr':\r\n                return $container.find('.page3');\r\n            case 'bl':\r\n            case 'tl':\r\n                return $container.find('.page2');\r\n        }\r\n    }\r\n\r\n    function getBackPage(corner: string): IJQueryNodes {\r\n        switch (corner) {\r\n            case 'br':\r\n            case 'tr':\r\n                return $container.find('.page4');\r\n            case 'bl':\r\n            case 'tl':\r\n                return $container.find('.page1');\r\n        }\r\n    }\r\n\r\n    function initCorner(corner: string) {\r\n        screenHeight = $scaler.height();\r\n        screenWidth = $scaler.width();\r\n        pageHeight = screenHeight;\r\n        pageWidth = screenWidth / 2;\r\n\r\n        $frontPage = getFrontPage(corner);\r\n        $backPage = getBackPage(corner);\r\n\r\n        $frontPageImg = $frontPage.find('img');\r\n        $backPageImg = $backPage.find('img');\r\n\r\n        var $current = $container.find('li.current');\r\n        switch (corner) {\r\n            case 'tr':\r\n            case 'br':\r\n                $container.addClass('active').addClass('active-next').removeClass('active-prev');\r\n                if ($container.find('li.current').next('li')) {\r\n                    cleanPages();\r\n                    $current.addClass('page1').next('li').addClass('page2').next('li').addClass('page3').next('li').addClass('page4');\r\n                }\r\n                break;\r\n            case 'tl':\r\n            case 'bl':\r\n                $container.addClass('active').removeClass('active-next').addClass('active-prev');\r\n                if ($container.find('li.current').prev('li').length) {\r\n                    cleanPages();\r\n                    $current.next('li').addClass('page4').prev('li').addClass('page3').prev('li').addClass('page2').prev('li').addClass('page1');\r\n                }\r\n                break;\r\n            default:\r\n                $container.removeClass('active').removeClass('active-next').removeClass('active-prev');\r\n                break;\r\n        }\r\n        touchCorner = corner;\r\n        touchDelta = getCornerShift(corner);\r\n\r\n        globalToLocalMatrix = getCornerMatrix(corner);\r\n        localToGlobalMatrix = globalToLocalMatrix.reverse();\r\n\r\n        localToTextureMatrix = getTextureMatrix(corner);\r\n        textureToLocalMatrix = localToTextureMatrix.reverse();\r\n    }\r\n\r\n    /**\r\n     * Check pointA to spine distance. We dont want page to be torn...\r\n     */\r\n    function fixPointA(pointA: Vector2D): Vector2D {\r\n        var screenWidth = $scaler.width();\r\n        var screenHeight = $scaler.height();\r\n\r\n        var pageWidth = screenWidth / 2;\r\n        var pageHeight = screenHeight;\r\n\r\n        if (pointA.length() < 10) pointA = new Vector2D(0, 0);\r\n\r\n        var spinePointB = new Vector2D(pageWidth, pageHeight);\r\n        var maxDiag = spinePointB.length();\r\n        var diag = pointA.sub(spinePointB);\r\n        if (diag.length() > maxDiag) {\r\n            diag = diag.changeLength(maxDiag);\r\n            pointA = diag.add(spinePointB);\r\n        }\r\n\r\n        var spinePointA = new Vector2D(pageWidth, 0);\r\n        var dir = pointA.sub(spinePointA);\r\n        if (dir.length() > pageWidth) {\r\n            dir = dir.changeLength(pageWidth);\r\n            pointA = dir.add(spinePointA);\r\n        }\r\n\r\n        return pointA;\r\n    }\r\n\r\n    /**\r\n     * Easing function\r\n     */\r\n    function easeInOutCubic(t: number, b: number, c: number, d: number): number {\r\n        t /= d / 2;\r\n        if (t < 1) return c / 2 * t * t * t + b;\r\n        t -= 2;\r\n        return c / 2 * (t * t * t + 2) + b;\r\n    };\r\n\r\n    (function () {\r\n        var mouseDownStart: Vector2D;\r\n        var state = 'init';\r\n        var $handle: IJQueryNodes;\r\n\r\n        var dragging = null;\r\n        var draggingPreview = null;\r\n\r\n        function getMousePosition(ev: IJQueryEvent): Vector2D {\r\n            if (ev.type.indexOf('touch') >= 0) {\r\n                var touchEvent = <TouchEvent>ev.originalEvent\r\n                var touch = touchEvent.touches[0];\r\n                if (touch) {\r\n                    return new Vector2D(touch.clientX, touch.clientY);\r\n                } else {\r\n                    touch = touchEvent.changedTouches[0];\r\n                    return new Vector2D(touch.clientX, touch.clientY);\r\n                }\r\n            }\r\n            return new Vector2D(ev.clientX, ev.clientY);\r\n        }\r\n\r\n        function checkThreshold(a: Vector2D, b: Vector2D): boolean {\r\n            return a.sub(b).length() > 5;\r\n        }\r\n\r\n        function createDragArgs(ev: IJQueryEvent) {\r\n            var pos = getMousePosition(ev);\r\n            var rect = $scaler[0].getBoundingClientRect();\r\n            var start = new Vector2D(rect.left, rect.top);\r\n            return {\r\n                rel: pos.sub(start),\r\n                $handle: $handle,\r\n                event: ev\r\n            };\r\n        }\r\n\r\n        function dragStart(ev: IJQueryEvent) {\r\n            var dragArgs = createDragArgs(ev);\r\n            dragging = {};\r\n            draggingPreview = null;\r\n            return true;\r\n        }\r\n\r\n        function dragMove(ev: IJQueryEvent) {\r\n            if (dragging) {\r\n                dragFold(ev);\r\n            }\r\n        }\r\n\r\n        function dragFold(ev: IJQueryEvent) {\r\n            var args = createDragArgs(ev);\r\n            var corner = getCornerType(args.$handle);\r\n            initCorner(corner);\r\n            var cm = getCornerMatrix(corner);\r\n            touchPointA = cm.transformVector(args.rel);\r\n\r\n            refresh(touchPointA);\r\n        }\r\n\r\n        function dragAnimate(target: Vector2D) {\r\n            var start = touchPointA;\r\n            var delta = target.sub(start);\r\n            return animate((stage: number) => {\r\n                var vector = delta.mul(stage).add(start);\r\n                touchPointA = vector;\r\n                refresh(vector);\r\n            }).done(() => {\r\n                cleanPages();\r\n                clean();\r\n            });\r\n        }\r\n\r\n        function dragEnd(ev: IJQueryEvent) {\r\n            if (dragging) {\r\n                var screenWidth = $scaler.width();\r\n                var pageWidth = screenWidth / 2;\r\n                if (touchPointA.x > pageWidth) {\r\n                    dragAnimate(new Vector2D(screenWidth, 0)).done(() => {\r\n                        shiftCurrent(touchDelta);\r\n                    });\r\n                } else {\r\n                    dragCancel(ev);\r\n                }\r\n                dragging = null;\r\n            }\r\n        }\r\n\r\n        function dragCancel(ev: IJQueryEvent) {\r\n            if (dragging) {\r\n                dragAnimate(new Vector2D(0, 0));\r\n                dragging = null;\r\n            }\r\n        }\r\n\r\n        function dragCheck(ev: IJQueryEvent, canCancel: boolean): any {\r\n            if (state === 'drag') {\r\n                if (canCancel) {\r\n                    ev.preventDefault();\r\n                    ev.stopPropagation();\r\n                }\r\n                return dragMove(ev);\r\n            } else if (state === 'threshold') {\r\n                var pos = getMousePosition(ev);\r\n                if (checkThreshold(mouseDownStart, pos)) {\r\n                    state = 'drag';\r\n                    var res = dragStart(ev);\r\n                    if (!res) state = 'init';\r\n                    return res;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n\r\n        $('html, body').on('mousedown touchstart', '.page-turn .corner', function (ev) {\r\n            var $evtarget = $(ev.target);\r\n            if (state === 'init') {\r\n                mouseDownStart = getMousePosition(ev);\r\n                ev.preventDefault();\r\n                ev.stopPropagation();\r\n                state = 'threshold';\r\n                $handle = $evtarget.closest('.corner');\r\n            }\r\n        }).on('mousemove touchmove', '.page-turn .corner', function (ev) {\r\n            if (dragging) return;\r\n            draggingPreview = {};\r\n            $handle = $(ev.target).closest('.corner');\r\n            dragFold(ev);\r\n        }).on('mouseout touchend', '.page-turn .corner', function (ev) {\r\n            if (!draggingPreview) return;\r\n            draggingPreview = null;\r\n            dragAnimate(new Vector2D(0, 0));\r\n        }).bind('mousemove touchmove', function (ev) {\r\n            return dragCheck(ev, true);\r\n        }).bind('mousewheel', function (ev) {\r\n            return dragCheck(ev, false);\r\n        }).bind('mouseup touchend', function (ev: IJQueryEvent) {\r\n            if (state === 'drag') {\r\n                ev.preventDefault();\r\n                ev.stopPropagation();\r\n                dragEnd(ev);\r\n            } else if (state === 'threshold') {\r\n                animateArrow(getCornerType($handle));\r\n            }\r\n            state = 'init';\r\n        }).bind('keydown', function (ev) {\r\n            if (!dragging) return;\r\n\r\n            if (ev.keyCode === 27) {      //escape\r\n                dragCancel(ev);\r\n            }\r\n        });\r\n\r\n    })();\r\n\r\n    function getPointAFromStage(stage: number): Vector2D {\r\n        var angle = 45 + 45 * stage; //symmetry line angle changes from 45 to 90.\r\n        angle = angle * Math.PI / 180;\r\n\r\n        var fx = stage * pageWidth;\r\n        var fy = 0;\r\n\r\n        var foldA = new Vector2D(fx, fy);\r\n\r\n        var dpl = fx * Math.cos(angle);\r\n        var dpx = dpl * Math.cos(angle);\r\n        var dpy = dpl * Math.sin(angle);\r\n\r\n        var pointM = new Vector2D(fx - dpx, dpy);\r\n\r\n        return pointM.mul(2);\r\n    }\r\n\r\n    function getFoldB(pointA: Vector2D, pointB: Vector2D, pointC: Vector2D) {\r\n        var ba = pointB.sub(pointA);\r\n\r\n        if (ba.x == 0) {\r\n            return new Vector2D(pointA.x, pageHeight);\r\n        }\r\n        var kx = -pointA.x / ba.x;\r\n        if (kx >= 0 && kx <= 1) {\r\n            return ba.mul(kx).add(pointA);\r\n        }\r\n\r\n        var cb = pointC.sub(pointB);\r\n        var ky = (pageHeight - pointB.y) / cb.y;\r\n        return cb.mul(ky).add(pointB);\r\n    }\r\n\r\n    function calculateFoldByCorner(pointA: Vector2D): IFold {\r\n        var pointM = pointA.mul(0.5);\r\n        var symmetryLine = pointM.rotateClockwise90(); // starts at pointM and goes to both directions\r\n\r\n        var foldA: Vector2D;\r\n        if (symmetryLine.y != 0) {\r\n            var ka = -pointM.y / symmetryLine.y;\r\n            foldA = pointM.add(symmetryLine.mul(ka));\r\n        } else {\r\n            foldA = new Vector2D(pointM.x, 0);\r\n        }\r\n\r\n        var pointB: Vector2D;\r\n        if (foldA.x == pointA.x && foldA.y == pointA.y) {\r\n            pointB = pointA.add(new Vector2D(0, pageHeight));\r\n        } else {\r\n            pointB = foldA.sub(pointA).rotateClockwise90().changeLength(pageHeight).add(pointA);\r\n        }\r\n\r\n        var pointC = pointA.sub(pointB).rotateClockwise90().changeLength(pageWidth).add(pointB);\r\n        var pointD = pointB.sub(pointC).rotateClockwise90().changeLength(pageHeight).add(pointC);\r\n\r\n        return {\r\n            pointA: pointA,\r\n            pointB: pointB,\r\n            pointC: pointC,\r\n            pointD: pointD,\r\n            pointE: new Vector2D(0, 0),\r\n            foldA: foldA,\r\n            foldB: getFoldB(pointA, pointB, pointC)\r\n        }\r\n    }\r\n\r\n    function calculateFold(): IFold {\r\n        var pointA = touchPointA;// getPointAFromStage(stage);\r\n        pointA = fixPointA(pointA);\r\n        var fold = calculateFoldByCorner(pointA);\r\n\r\n        return {\r\n            foldA: fold.foldA,\r\n            foldB: fold.foldB,\r\n            pointA: fold.pointA,\r\n            pointB: fold.pointB,\r\n            pointC: fold.pointC,\r\n            pointD: fold.pointD,\r\n            pointE: fold.pointE\r\n        };\r\n    }\r\n\r\n    function dumpFold(localFold: IFold) {\r\n        function debugPoint($point: IJQueryNodes, vector: Vector2D) {\r\n            vector = localToGlobalMatrix.transformVector(vector);\r\n            $point.css({\r\n                left: (100 * vector.x / screenWidth) + '%',\r\n                top: (100 * vector.y / screenHeight) + '%'\r\n            })\r\n        }\r\n\r\n        debugPoint($('.fold-point-A'), localFold.foldA);\r\n        debugPoint($('.fold-point-B'), localFold.foldB);\r\n        debugPoint($('.point-a'), localFold.pointA);\r\n        debugPoint($('.point-b'), localFold.pointB);\r\n        debugPoint($('.point-c'), localFold.pointC);\r\n        debugPoint($('.point-d'), localFold.pointD);\r\n        debugPoint($('.point-e'), localFold.pointE);\r\n    }\r\n\r\n    function getOuterClipMatrix(pointO: Vector2D, pointU: Vector2D, pointV: Vector2D, originalWidth: number, originalHeight: number): Matrix2D {\r\n        var clipX = pointU.sub(pointO).mul(1 / originalWidth);\r\n        var clipY = pointV.sub(pointO).mul(1 / originalHeight);\r\n        return new Matrix2D([clipX.x, clipX.y, 0, clipY.x, clipY.y, 0, 0, 0, 1]).translate(pointO);\r\n    }\r\n\r\n    function setupPage($page: IJQueryNodes, $img: IJQueryNodes, matrix: Matrix2D, clipperMatrix: Matrix2D) {\r\n        $page.css({\r\n            transform: clipperMatrix.getTransformExpression()\r\n        })\r\n\r\n        matrix = matrix.multiply(clipperMatrix.reverse());\r\n\r\n        $img.css({\r\n            transform: matrix.getTransformExpression()\r\n        })\r\n    }\r\n\r\n    function getPageMatrix(fold: IFold) {\r\n        var pageXAxis = fold.pointD.sub(fold.pointA).normalize();\r\n        var pageYAxis = fold.pointB.sub(fold.pointA).normalize();\r\n        var pageMatrix = new Matrix2D([pageXAxis.x, pageXAxis.y, 0, pageYAxis.x, pageYAxis.y, 0, 0, 0, 1]).translate(fold.pointA);\r\n\r\n        return localToTextureMatrix.multiply(pageMatrix);\r\n    }\r\n\r\n    function setupFrontPage(localFold: IFold) {\r\n        var frontPageMatrix = getPageMatrix(localFold).multiply(localToGlobalMatrix);\r\n\r\n        var clipperMatrix: Matrix2D;\r\n        if (localFold.foldA.x > localFold.foldB.x) { //triangle or trapezoid?\r\n            clipperMatrix = getOuterClipMatrix(localFold.foldA, localFold.pointA, localFold.foldB, pageWidth, pageHeight);\r\n        } else {\r\n            clipperMatrix = getOuterClipMatrix(localFold.foldB, localFold.pointB, localFold.foldA, pageWidth, pageHeight);\r\n        }\r\n        clipperMatrix = clipperMatrix.multiply(localToGlobalMatrix);\r\n\r\n        setupPage($frontPage, $frontPageImg, frontPageMatrix, clipperMatrix);\r\n    }\r\n\r\n    function setupBackPage(localFold: IFold) {\r\n        var spine = new Vector2D(pageWidth, 0);\r\n        spine = textureToLocalMatrix.transformVector(spine);\r\n        spine = localToGlobalMatrix.transformVector(spine);\r\n        var backPageMatrix = new Matrix2D().translate(spine);\r\n\r\n        var clipperMatrix: Matrix2D;\r\n        if (localFold.foldA.x > localFold.foldB.x) { //triangle or trapezoid?\r\n            clipperMatrix = getOuterClipMatrix(localFold.foldA, localFold.pointE, localFold.foldB, pageWidth, pageHeight);\r\n        } else {\r\n            clipperMatrix = getOuterClipMatrix(localFold.foldB, new Vector2D(0, pageHeight), localFold.foldA, pageWidth, pageHeight);\r\n        }\r\n        clipperMatrix = clipperMatrix.multiply(localToGlobalMatrix);\r\n\r\n        setupPage($backPage, $backPageImg, backPageMatrix, clipperMatrix);\r\n    }\r\n\r\n    function refresh(pointA: Vector2D) {\r\n        var localFold = calculateFold();\r\n\r\n        setupFrontPage(localFold);\r\n        setupBackPage(localFold);\r\n\r\n        dumpFold(localFold);\r\n    }\r\n\r\n    function cleanPages() {\r\n        return $container.find('li').removeClass('page1 page2 page3 page4')\r\n    }\r\n\r\n    function clean() {\r\n        $container.removeClass('active').find('li').css('transform', '').find('img').css('transform', '');\r\n    }\r\n\r\n    function refreshState() {\r\n        var $current = $container.find('li.current');\r\n        $container.toggleClass('can-prev-2', !!$current.prev('li').length);\r\n        $container.toggleClass('can-next-2', !!$current.next('li').length);\r\n    }\r\n\r\n    function shiftCurrent(delta: number) {\r\n        var $current = $container.find('li.current');\r\n        var $currentOne = $container.find('li.current-one');\r\n\r\n        var $node = $current;\r\n        var $nodeOne = $currentOne;\r\n        while (delta >= 2) {\r\n            $node = $node.next('li').next('li');;\r\n            $nodeOne = $nodeOne.next('li').next('li');;\r\n            delta -= 2;\r\n        }\r\n        while (delta <= -2) {\r\n            $node = $node.prev('li').prev('li');;\r\n            $nodeOne = $nodeOne.prev('li').prev('li');;\r\n            delta += 2;\r\n        }\r\n        while (delta >= 1) {\r\n            if ($node[0] == $nodeOne[0]) {\r\n                $nodeOne = $nodeOne.next('li');\r\n            } else {\r\n                $node = $node.next('li').next('li');\r\n                $nodeOne = $nodeOne.next('li');\r\n            }\r\n            delta--;\r\n        }\r\n        while (delta <= -1) {\r\n            if ($node[0] == $nodeOne[0]) {\r\n                $node = $node.prev('li').prev('li');\r\n                $nodeOne = $nodeOne.prev('li');\r\n            } else {\r\n                $nodeOne = $nodeOne.prev('li');\r\n            }\r\n            delta++;\r\n        }\r\n        if ($node.length) {\r\n            $current.removeClass('current');\r\n            $currentOne.removeClass('current-one');\r\n            $node.addClass('current');\r\n            $nodeOne.addClass('current-one');\r\n        }\r\n\r\n        refreshState();\r\n\r\n        preloadImages();\r\n\r\n        return $node;\r\n    }\r\n\r\n    function animate(callback: { (stage: number) }) {\r\n        var frame = 0;\r\n        var step = 4;\r\n\r\n        callback(0);\r\n\r\n        var promise = $.Deferred();\r\n        function draw() {\r\n            requestAnimationFrame(() => {\r\n                frame += step;\r\n                frame = Math.min(frame, 100);\r\n                var x = easeInOutCubic(frame / 100, 0, 1, 1);\r\n                callback(x)\r\n                if (frame < 100) {\r\n                    draw();\r\n                } else {\r\n                    promise.resolve();\r\n                }\r\n            });\r\n        }\r\n\r\n        draw();\r\n\r\n        return promise;\r\n    }\r\n\r\n    function animateArrow(corner: string) {\r\n        initCorner(corner);\r\n        animate(stage => {\r\n            var pointA = getPointAFromStage(stage);\r\n            touchPointA = pointA;\r\n            refresh(touchPointA);\r\n        }).done(() => {\r\n            cleanPages();\r\n            clean();\r\n            shiftCurrent(touchDelta);\r\n        });\r\n    }\r\n\r\n    function preloadImages() {\r\n        preloadNextImages();\r\n        preloadPrevImages();\r\n    }\r\n\r\n    var preloaders = {};\r\n\r\n    function preloadImage($img: IJQueryNodes) {\r\n        if (!$img.length) return;\r\n        var imgNode = <HTMLImageElement>$img[0];\r\n        var src = imgNode.src;\r\n        var img = new Image()\r\n        img.src = src;\r\n        img.onload = function () {\r\n            console.log(src);\r\n        }\r\n        preloaders[src] = img;\r\n    }\r\n\r\n    function preloadNextImages() {\r\n        var $current = $scaler.find('li.current');\r\n        for (var i = 0; i < 3; i++) {\r\n            var $current = $current.next('li');\r\n            var $img = $current.find('img');\r\n            preloadImage($img);\r\n        }\r\n    }\r\n\r\n    function preloadPrevImages() {\r\n        var $current = $scaler.find('li.current');\r\n        for (var i = 0; i < 3; i++) {\r\n            var $current = $current.prev('li');\r\n            var $img = $current.find('img');\r\n            preloadImage($img);\r\n        }\r\n    }\r\n\r\n    function animateFlipForward() {\r\n        var $newBase = $container.find('li.current').next('li');\r\n        if ($newBase.length) {\r\n            animateArrow('br');\r\n        }\r\n    }\r\n\r\n    function animateFlipBackward() {\r\n        var $newBase = $container.find('li.current').prev('li');\r\n        if ($newBase.length) {\r\n            animateArrow('bl');\r\n        }\r\n    }\r\n\r\n    preloadImages();\r\n    refreshState();\r\n\r\n    $('body').on('click', '.page-turn .nav-next-2', () => {\r\n        animateFlipForward();\r\n    }).on('click', '.page-turn .nav-prev-2', () => {\r\n        animateFlipBackward();\r\n    }).on('click', '.page-turn .nav-next', () => {\r\n        shiftCurrent(1);\r\n    }).on('click', '.page-turn .nav-prev', () => {\r\n        shiftCurrent(-1);\r\n    });\r\n\r\n});\r\n\r\n"],"sourceRoot":"/source/"}