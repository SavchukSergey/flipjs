{"version":3,"sources":["matrix-2d.ts","vector-2d.ts","fold.ts","flipper.ts"],"names":[],"mappings":"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","file":"flipper.js","sourcesContent":["class Matrix2D {\r\n\r\n    private m: number[];\r\n\r\n    constructor(elements?: number[]) {\r\n        this.m = elements || [1, 0, 0, 0, 1, 0, 0, 0, 1];\r\n    }\r\n\r\n    public transformVector(v: IVector2D) : IVector2D {\r\n        return new Vector2D(\r\n            v.x * this.m[0] + v.y * this.m[3] + this.m[6],\r\n            v.x * this.m[1] + v.y * this.m[4] + this.m[7]\r\n        );\r\n    }\r\n    public determinant() {\r\n        var ax = this.m[0];\r\n        var ay = this.m[1];\r\n        var az = this.m[2];\r\n        var bx = this.m[3];\r\n        var by = this.m[4];\r\n        var bz = this.m[5];\r\n        var cx = this.m[6];\r\n        var cy = this.m[7];\r\n        var cz = this.m[8];\r\n\r\n        var dx = by * cz - bz * cy;\r\n        var dy = bz * cx - bx * cz;\r\n        var dz = bx * cy - by * cx;\r\n        return ax * dx + ay * dy + az * dz;\r\n    }\r\n\r\n    private multiplyArray(other: number[]) {\r\n        return new Matrix2D([\r\n            this.m[0] * other[0] + this.m[1] * other[3] + this.m[2] * other[6],\r\n            this.m[0] * other[1] + this.m[1] * other[4] + this.m[2] * other[7],\r\n            this.m[0] * other[2] + this.m[1] * other[5] + this.m[2] * other[8],\r\n\r\n            this.m[3] * other[0] + this.m[4] * other[3] + this.m[5] * other[6],\r\n            this.m[3] * other[1] + this.m[4] * other[4] + this.m[5] * other[7],\r\n            this.m[3] * other[2] + this.m[4] * other[5] + this.m[5] * other[8],\r\n\r\n            this.m[6] * other[0] + this.m[7] * other[3] + this.m[8] * other[6],\r\n            this.m[6] * other[1] + this.m[7] * other[4] + this.m[8] * other[7],\r\n            this.m[6] * other[2] + this.m[7] * other[5] + this.m[8] * other[8]\r\n        ]);\r\n    }\r\n\r\n    public multiply(other: Matrix2D): Matrix2D {\r\n        return this.multiplyArray(other.getElements());\r\n    }\r\n\r\n    public translate(vector: IVector2D): Matrix2D {\r\n        return this.multiplyArray([1, 0, 0, 0, 1, 0, vector.x, vector.y, 1]);\r\n    }\r\n\r\n    public scale(kx: number, ky: number): Matrix2D {\r\n        return this.multiplyArray([kx, 0, 0, 0, ky, 0, 0, 0, 1]);\r\n    }\r\n\r\n    public rotate(deg: number): Matrix2D {\r\n        var angle = deg * Math.PI / 180;\r\n        var ca = Math.cos(angle);\r\n        var sa = Math.sin(angle);\r\n        return this.multiplyArray([ca, sa, 0, -sa, ca, 0, 0, 0, 1]);\r\n    }\r\n\r\n    public reverse(): Matrix2D {\r\n        var det = this.determinant();\r\n\r\n        var ux = this.m[0];\r\n        var uy = this.m[3];\r\n        var uz = this.m[6];\r\n\r\n        var vx = this.m[1];\r\n        var vy = this.m[4];\r\n        var vz = this.m[7];\r\n\r\n        var wx = this.m[2];\r\n        var wy = this.m[5];\r\n        var wz = this.m[8];\r\n\r\n        var c11 = (vy * wz - wy * vz) / det;\r\n        var c12 = (wy * uz - uy * wz) / det;\r\n        var c13 = (uy * vz - vy * uz) / det;\r\n\r\n        var c21 = (wx * vz - vx * wz) / det;\r\n        var c22 = (ux * wz - wx * uz) / det;\r\n        var c23 = (vx * uz - ux * vz) / det;\r\n\r\n        var c31 = (vx * wy - wx * vy) / det;\r\n        var c32 = (wx * uy - ux * wy) / det;\r\n        var c33 = (ux * vy - vx * uy) / det;\r\n\r\n        return new Matrix2D([c11, c21, c31, c12, c22, c32, c13, c23, c33]);\r\n    }\r\n\r\n    public getElements() {\r\n        return this.m.slice(0);\r\n    }\r\n\r\n    private roundFloat(v) {\r\n        return Math.round(v * 1e8) / 1e8;\r\n    }\r\n\r\n    public getTransformExpression() {\r\n        return `matrix(${this.roundFloat(this.m[0])}, ${this.roundFloat(this.m[1])}, ${this.roundFloat(this.m[3])}, ${this.roundFloat(this.m[4])}, ${this.roundFloat(this.m[6])}, ${this.roundFloat(this.m[7])})`;\r\n    }\r\n\r\n}\r\n","function Vector2D(x, y) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    this.length = function () {\r\n        return Math.sqrt(this.x * this.x + this.y * this.y);\r\n    };\r\n\r\n    this.sub = function (other) {\r\n        return new Vector2D(this.x - other.x, this.y - other.y);\r\n    };\r\n\r\n    this.add = function (other) {\r\n        return new Vector2D(this.x + other.x, this.y + other.y);\r\n    };\r\n\r\n    this.mul = function (val) {\r\n        return new Vector2D(this.x * val, this.y * val);\r\n    };\r\n\r\n    this.rotateClockwise90 = function () {\r\n        return new Vector2D(this.y, -this.x);\r\n    };\r\n\r\n    this.rotateCounterClockwise90 = function () {\r\n        return new Vector2D(-this.y, this.x);\r\n    };\r\n\r\n    this.changeLength = function (val) {\r\n        var len = this.length();\r\n        if (!len) len = 1;\r\n        return this.mul(val / len);\r\n    };\r\n\r\n    this.normalize = function () {\r\n        return this.changeLength(1);\r\n    }\r\n\r\n    this.toString = function() {\r\n        return `{{${this.x}, ${this.y}}}`;\r\n    };\r\n\r\n}\r\n\r\ninterface IVector2D {\r\n\r\n    sub(other: IVector2D): IVector2D;\r\n\r\n    add(other: IVector2D): IVector2D;\r\n\r\n    rotateClockwise90(): IVector2D;\r\n\r\n    changeLength(len: number): IVector2D;\r\n\r\n    mul(k: number) : IVector2D;\r\n\r\n    length(): number;\r\n\r\n    normalize(): IVector2D;\r\n\r\n    x: number;\r\n\r\n    y: number;\r\n\r\n}","///<reference path=\"vector-2d.ts\" />\r\n\r\ninterface IFold {\r\n\r\n    foldA: IVector2D;\r\n\r\n    foldB: IVector2D;\r\n\r\n\r\n    /**\r\n     * Touch corner position\r\n     */\r\n    pointA: IVector2D;\r\n\r\n    pointB: IVector2D;\r\n\r\n    pointC: IVector2D;\r\n\r\n    pointD: IVector2D;\r\n    \r\n    pointE: IVector2D;\r\n    \r\n}","///<reference path=\"matrix-2d.ts\" />\r\n///<reference path=\"vector-2d.ts\" />\r\n///<reference path=\"fold.ts\" />\r\n\r\ndeclare var $: any;\r\n\r\n$(document).ready(function () {\r\n\r\n    var $container = $('.page-turn');\r\n    var $scaler = $container.find('.scaler');\r\n\r\n    var touchPointA: IVector2D;\r\n    var touchCorner = 'right';\r\n\r\n    function getCornerMatrix($corner): Matrix2D {\r\n        var screenHeight: number = $scaler.height();\r\n        var screenWidth: number = $scaler.width();\r\n\r\n        if ($corner.hasClass('corner-br')) {\r\n            return new Matrix2D().translate(new Vector2D(-screenWidth, -screenHeight)).scale(-1, -1);\r\n        }\r\n\r\n        if ($corner.hasClass('corner-bl')) {\r\n            return new Matrix2D().translate(new Vector2D(0, -screenHeight)).scale(1, -1);\r\n        }\r\n\r\n        if ($corner.hasClass('corner-tr')) {\r\n            return new Matrix2D().translate(new Vector2D(-screenWidth, 0)).scale(-1, 1);\r\n        }\r\n\r\n        if ($corner.hasClass('corner-tl')) {\r\n            return new Matrix2D().translate(new Vector2D(0, 0)).scale(1, 1);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    function fixPointA(pointA: IVector2D): IVector2D {\r\n        var screenWidth: number = $scaler.width();\r\n        var screenHeight: number = $scaler.height();\r\n\r\n        var pageWidth = screenWidth / 2;\r\n        var pageHeight = screenHeight;\r\n\r\n        var spinPoint: IVector2D = new Vector2D(pageWidth, 0);\r\n        var dir = pointA.sub(spinPoint);\r\n        if (dir.length() > pageWidth) {\r\n            dir = dir.changeLength(pageWidth);\r\n            pointA = dir.add(spinPoint);\r\n        }\r\n        return pointA;\r\n    }\r\n\r\n    function easeInOutCubic(t: number, b: number, c: number, d: number) {\r\n        t /= d / 2;\r\n        if (t < 1) return c / 2 * t * t * t + b;\r\n        t -= 2;\r\n        return c / 2 * (t * t * t + 2) + b;\r\n    };\r\n\r\n    (function () {\r\n        var mouseDownStart;\r\n        var state = 'init';\r\n        var $target;\r\n        var $handle;\r\n\r\n        var cssBackup = {\r\n            zIndex: ''\r\n        };\r\n\r\n        var dragging = null;\r\n\r\n        function getMousePosition(ev) {\r\n            if (ev.type.indexOf('touch') >= 0) {\r\n\r\n                var touch = ev.originalEvent.touches[0];\r\n                if (touch) {\r\n                    return {\r\n                        x: touch.clientX,\r\n                        y: touch.clientY\r\n                    };\r\n                } else {\r\n                    touch = ev.originalEvent.changedTouches[0];\r\n                    return {\r\n                        x: touch.clientX,\r\n                        y: touch.clientY\r\n                    };\r\n                }\r\n            }\r\n            return {\r\n                x: ev.clientX,\r\n                y: ev.clientY\r\n            };\r\n        }\r\n\r\n        function checkThreshold(a, b) {\r\n            var dx = a.x - b.x;\r\n            var dy = a.y - b.y;\r\n            var d = Math.sqrt(dx * dx + dy * dy);\r\n            return d > 5;\r\n        }\r\n\r\n        function getDragVector(ev) {\r\n            var pos = getMousePosition(ev);\r\n\r\n            return {\r\n                x: pos.x - mouseDownStart.x,\r\n                y: pos.y - mouseDownStart.y\r\n            };\r\n        }\r\n\r\n        function createDragArgs(ev) {\r\n            var vector = getDragVector(ev);\r\n            var pos = getMousePosition(ev);\r\n            var rect = $scaler[0].getBoundingClientRect();\r\n            var rel = {\r\n                x: pos.x - rect.left,\r\n                y: pos.y - rect.top\r\n            }\r\n            return {\r\n                rel: new Vector2D(rel.x, rel.y),\r\n                vector: vector,\r\n                position: pos,\r\n                pageX: ev.pageX,\r\n                pageY: ev.pageY,\r\n                $handle: $handle,\r\n                $target: $target,\r\n                event: ev\r\n            };\r\n        }\r\n\r\n        function createCssBackup() {\r\n            if (!$target) debugger;\r\n            var target = $target[0];\r\n            if (!target) return null;\r\n            return {\r\n                zIndex: target.style.zIndex\r\n            };\r\n        }\r\n\r\n        function restoreCss(backup) {\r\n            var target = $target[0];\r\n            if (target) {\r\n                target.style.zIndex = backup.zIndex;\r\n            }\r\n        }\r\n\r\n        function dragStart(ev) {\r\n            cssBackup = createCssBackup();\r\n            var dragArgs = createDragArgs(ev);\r\n            dragging = {\r\n            };\r\n\r\n            var res = !dragging.start || dragging.start(dragArgs);\r\n            if (!res) dragging = null;\r\n            return res;\r\n        }\r\n\r\n        function dragMove(ev) {\r\n            if (dragging) {\r\n                var args = createDragArgs(ev);\r\n                var screenHeight: number = $scaler.height();\r\n                var screenWidth: number = $scaler.width();\r\n\r\n                var pageWidth = screenWidth / 2;\r\n                var pageHeight = screenHeight;\r\n\r\n                var cm = getCornerMatrix(args.$target);\r\n                var corner = new Vector2D(screenWidth, pageHeight);\r\n                touchPointA = cm.transformVector(args.rel);\r\n                var delta = 1;\r\n                $container.addClass('active').toggleClass('active-next', delta > 0).toggleClass('active-prev', delta < 0);\r\n                var $newBase = $container.find('li.current').next('li').next('li');\r\n                if ($newBase.length) {\r\n                    cleanPages();\r\n                    $container.find('li.current').addClass('page1').next('li').addClass('page2').next('li').addClass('page3').next('li').addClass('page4');\r\n                }\r\n\r\n                refresh(touchPointA, null);\r\n\r\n                $handle.css({\r\n                    top: args.rel.y + 'px',\r\n                    left: args.rel.x + 'px',\r\n                })\r\n            }\r\n        }\r\n\r\n        function finalize() {\r\n        }\r\n\r\n        function dragEnd(ev) {\r\n            finalize();\r\n            if (dragging) {\r\n                if (dragging.stop) dragging.stop(createDragArgs(ev));\r\n                dragging = null;\r\n\r\n                restoreCss(cssBackup);\r\n            }\r\n        }\r\n\r\n        function dragCancel(ev) {\r\n            finalize();\r\n            if (dragging) {\r\n                dragging.cancel(createDragArgs(ev));\r\n                dragging = null;\r\n\r\n                restoreCss(cssBackup);\r\n            }\r\n        }\r\n\r\n        function dragCheck(ev, canCancel) {\r\n            if (state === 'drag') {\r\n                if (canCancel) {\r\n                    ev.preventDefault();\r\n                    ev.stopPropagation();\r\n                }\r\n                return dragMove(ev);\r\n            } else if (state === 'threshold') {\r\n                var pos = getMousePosition(ev);\r\n                if (checkThreshold(mouseDownStart, pos)) {\r\n                    state = 'drag';\r\n                    var res = dragStart(ev);\r\n                    if (!res) state = 'init';\r\n                    return res;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n\r\n        $('html, body').on('mousedown touchstart', '.page-turn .corner', function (ev) {\r\n            var $evtarget = $(ev.target);\r\n            if (state === 'init') {\r\n                mouseDownStart = getMousePosition(ev);\r\n                ev.preventDefault();\r\n                ev.stopPropagation();\r\n                state = 'threshold';\r\n                $handle = $evtarget;\r\n\r\n                $target = $handle.closest('.corner');\r\n                $target = $target || $handle;\r\n            }\r\n        }).bind('mousemove touchmove', function (ev) {\r\n            return dragCheck(ev, true);\r\n        }).bind('mousewheel', function (ev) {\r\n            return dragCheck(ev, false);\r\n        }).bind('mouseup touchend', function (ev) {\r\n            if (state === 'drag') {\r\n                ev.preventDefault();\r\n                ev.stopPropagation();\r\n                dragEnd(ev);\r\n            } else if (state === 'threshold') {\r\n                finalize();\r\n            }\r\n            state = 'init';\r\n        }).bind('keydown', function (ev) {\r\n            if (!dragging) return;\r\n\r\n            if (ev.keyCode === 27) {      //escape\r\n                dragCancel(ev);\r\n            }\r\n        });\r\n\r\n    })();\r\n\r\n    var stage = 0;\r\n\r\n    function setStage(corner, frame) {\r\n        touchCorner = corner;\r\n        stage = frame;\r\n\r\n        stage = Math.min(1, stage);\r\n        stage = Math.max(0, stage);\r\n    }\r\n\r\n    function getPointAFromStage(stage: number) {\r\n        var screenHeight: number = $scaler.height();\r\n        var screenWidth: number = $scaler.width();\r\n\r\n        var pageWidth = screenWidth / 2;\r\n        var pageHeight = screenHeight;\r\n\r\n        var angle = 45 + 45 * stage; //symmetry line angle changes from 45 to 90.\r\n        angle = angle * Math.PI / 180;\r\n\r\n        var x = easeInOutCubic(stage, 0, 1, 1);\r\n\r\n        var fx = x * pageWidth;\r\n        var fy = 0;\r\n\r\n        var foldA: IVector2D = new Vector2D(fx, fy);\r\n\r\n        var dpl = fx * Math.cos(angle);\r\n        var dpx = dpl * Math.cos(angle);\r\n        var dpy = dpl * Math.sin(angle);\r\n\r\n        var pointM = new Vector2D(fx - dpx, dpy);\r\n\r\n        return pointM.mul(2);\r\n    }\r\n\r\n    function getFoldB(pointA: IVector2D, pointB: IVector2D) {\r\n        var screenHeight: number = $scaler.height();\r\n        var screenWidth: number = $scaler.width();\r\n\r\n        var pageWidth = screenWidth / 2;\r\n        var pageHeight = screenHeight;\r\n\r\n        var ba = pointB.sub(pointA);\r\n\r\n        var kx = -pointA.x / ba.x;\r\n        var ky = (pageHeight - pointA.y) / ba.y;\r\n\r\n        var k = Math.min(kx, ky, 1);\r\n        return ba.mul(k).add(pointA);\r\n        \r\n    }\r\n\r\n    function calculateFoldByCorner(pointA: IVector2D) {\r\n        var screenHeight: number = $scaler.height();\r\n        var screenWidth: number = $scaler.width();\r\n\r\n        var pageWidth = screenWidth / 2;\r\n        var pageHeight = screenHeight;\r\n\r\n        var pointM = pointA.mul(0.5);\r\n        var symmetryLine = pointM.rotateClockwise90(); // starts at pointM and goes to both directions\r\n\r\n        var ka = -pointM.y / symmetryLine.y;\r\n        var foldA = pointM.add(symmetryLine.mul(ka));\r\n\r\n        var pointB = foldA.sub(pointA).rotateClockwise90().changeLength(pageHeight).add(pointA);\r\n        var pointC = pointA.sub(pointB).rotateClockwise90().changeLength(pageWidth).add(pointB);\r\n        var pointD = pointB.sub(pointC).rotateClockwise90().changeLength(pageHeight).add(pointC);\r\n\r\n        return {\r\n            pointA: pointA,\r\n            pointB: pointB,\r\n            pointC: pointC,\r\n            pointD: pointD,\r\n            foldA: foldA,\r\n            foldB: getFoldB(pointA, pointB)\r\n        }\r\n    }\r\n\r\n    function calculateFold(stage: number): IFold {\r\n        var pointA = touchPointA;// getPointAFromStage(stage);\r\n        pointA = fixPointA(pointA);\r\n        var fold = calculateFoldByCorner(pointA);\r\n\r\n        return {\r\n            foldA: fold.foldA,\r\n            foldB: fold.foldB,\r\n            pointA: fold.pointA,\r\n            pointB: fold.pointB,\r\n            pointC: fold.pointC,\r\n            pointD: fold.pointD,\r\n            pointE: new Vector2D(0, 0)\r\n        };\r\n    }\r\n\r\n    function getGlobalFold(fold: IFold): IFold {\r\n        var screenHeight = $scaler.height();\r\n        var screenWidth = $scaler.width();\r\n\r\n        var pageWidth = screenWidth / 2;\r\n        var pageHeight = screenHeight;\r\n\r\n        function toGlobal(vector) {\r\n            if (touchCorner == 'right') {\r\n                return new Vector2D(screenWidth - vector.x, screenHeight - vector.y);\r\n            } else if (touchCorner == 'left') {\r\n                return new Vector2D(vector.x, screenHeight - vector.y);\r\n            }\r\n        }\r\n\r\n        return {\r\n            foldA: toGlobal(fold.foldA),\r\n            foldB: toGlobal(fold.foldB),\r\n            pointA: toGlobal(fold.pointA),\r\n            pointB: toGlobal(fold.pointB),\r\n            pointC: toGlobal(fold.pointC),\r\n            pointD: toGlobal(fold.pointD),\r\n            pointE: toGlobal(fold.pointE)\r\n        };\r\n    }\r\n\r\n    function dumpFold(globalFold: IFold) {\r\n        var screenHeight = $scaler.height();\r\n        var screenWidth = $scaler.width();\r\n\r\n        function debugPoint($point, vector: IVector2D) {\r\n            $point.css({\r\n                left: (100 * vector.x / screenWidth) + '%',\r\n                top: (100 * vector.y / screenHeight) + '%'\r\n            })\r\n        }\r\n\r\n        debugPoint($('.fold-point-A'), globalFold.foldA);\r\n        debugPoint($('.fold-point-B'), globalFold.foldB);\r\n        debugPoint($('.point-a'), globalFold.pointA);\r\n        debugPoint($('.point-b'), globalFold.pointB);\r\n        debugPoint($('.point-c'), globalFold.pointC);\r\n        debugPoint($('.point-d'), globalFold.pointD);\r\n        debugPoint($('.point-e'), globalFold.pointE);\r\n    }\r\n\r\n    function getOuterClipMatrix(pointO: IVector2D, pointU: IVector2D, pointV: IVector2D, originalWidth: number, originalHeight: number): Matrix2D {\r\n        var width = pointU.sub(pointO).length();\r\n        var height = pointV.sub(pointO).length();\r\n        var clipX = pointU.sub(pointO).changeLength(width / originalWidth);\r\n        var clipY = pointV.sub(pointO).changeLength(height / originalHeight);\r\n        return new Matrix2D([clipX.x, clipX.y, 0, clipY.x, clipY.y, 0, 0, 0, 1]).translate(pointO);\r\n    }\r\n\r\n    function setupPage($page, matrix: Matrix2D, clipperMatrix: Matrix2D) {\r\n        $page.css({\r\n            transform: clipperMatrix.getTransformExpression()\r\n        })\r\n\r\n        matrix = matrix.multiply(clipperMatrix.reverse());\r\n\r\n        $page.find('img').css({\r\n            transform: matrix.getTransformExpression()\r\n        })\r\n    }\r\n\r\n    function getPageMatrix(globalFold: IFold) {\r\n        if (touchCorner == 'right') {\r\n            var page3XAxis = globalFold.pointC.sub(globalFold.pointB).normalize();\r\n            var page3YAxis = globalFold.pointA.sub(globalFold.pointB).normalize();\r\n            return new Matrix2D([page3XAxis.x, page3XAxis.y, 0, page3YAxis.x, page3YAxis.y, 0, 0, 0, 1]).translate(globalFold.pointB);\r\n        } else if (touchCorner == 'left') {\r\n            var page3XAxis = globalFold.pointB.sub(globalFold.pointC).normalize();\r\n            var page3YAxis = globalFold.pointD.sub(globalFold.pointC).normalize();\r\n            return new Matrix2D([page3XAxis.x, page3XAxis.y, 0, page3YAxis.x, page3YAxis.y, 0, 0, 0, 1]).translate(globalFold.pointC);\r\n        }\r\n    }\r\n\r\n    function refresh(pointA: IVector2D, corner) {\r\n        var screenHeight: number = $scaler.height();\r\n        var screenWidth: number = $scaler.width();\r\n\r\n        var pageWidth = screenWidth / 2;\r\n        var pageHeight = screenHeight;\r\n\r\n        var localFold = calculateFold(stage);\r\n        var globalFold = getGlobalFold(localFold);\r\n\r\n        dumpFold(globalFold);\r\n\r\n        var pageMatrix = getPageMatrix(globalFold);\r\n\r\n        var clipperMatrix = getOuterClipMatrix(globalFold.foldA, globalFold.pointA, globalFold.foldB, pageWidth, pageHeight);\r\n\r\n        var clipper2Matrix = getOuterClipMatrix(globalFold.foldA, globalFold.pointE, globalFold.foldB, pageWidth, pageHeight);\r\n        if (touchCorner == 'right') {\r\n            var page4Matrix = new Matrix2D().translate(new Vector2D(pageWidth, 0));\r\n            setupPage($('.page3'), pageMatrix, clipperMatrix);\r\n            setupPage($('.page4'), page4Matrix, clipper2Matrix);\r\n        } else if (touchCorner == 'left') {\r\n            var page1Matrix = new Matrix2D().translate(new Vector2D(0, 0));\r\n\r\n            setupPage($('.page2'), pageMatrix, clipperMatrix);\r\n            setupPage($('.page1'), page1Matrix, clipper2Matrix);\r\n        }\r\n    }\r\n\r\n    function cleanPages() {\r\n        return $container.find('li').removeClass('page1 page2 page3 page4')\r\n    }\r\n\r\n    function clean() {\r\n        $container.removeClass('active').find('li').css('transform', '').find('img').css('transform', '');\r\n    }\r\n\r\n    function shiftCurrent(delta: number) {\r\n        var $current = $container.find('li.current');\r\n        var $currentOne = $container.find('li.current-one');\r\n\r\n        var $node = $current;\r\n        var $nodeOne = $currentOne;\r\n        while (delta >= 2) {\r\n            $node = $node.next('li').next('li');;\r\n            $nodeOne = $nodeOne.next('li').next('li');;\r\n            delta -= 2;\r\n        }\r\n        while (delta <= -2) {\r\n            $node = $node.prev('li').prev('li');;\r\n            $nodeOne = $nodeOne.prev('li').prev('li');;\r\n            delta += 2;\r\n        }\r\n        while (delta >= 1) {\r\n            if ($node[0] == $nodeOne[0]) {\r\n                $nodeOne = $nodeOne.next('li');\r\n            } else {\r\n                $node = $node.next('li').next('li');\r\n                $nodeOne = $nodeOne.next('li');\r\n            }\r\n            delta--;\r\n        }\r\n        while (delta <= -1) {\r\n            if ($node[0] == $nodeOne[0]) {\r\n                $node = $node.prev('li').prev('li');\r\n                $nodeOne = $nodeOne.prev('li');\r\n            } else {\r\n                $nodeOne = $nodeOne.prev('li');\r\n            }\r\n            delta++;\r\n        }\r\n        if ($node.length) {\r\n            $current.removeClass('current');\r\n            $currentOne.removeClass('current-one');\r\n            $node.addClass('current');\r\n            $nodeOne.addClass('current-one');\r\n        }\r\n\r\n        return $node;\r\n    }\r\n\r\n    function animate(corner: string, delta: number) {\r\n        touchCorner = corner;\r\n\r\n        clean();\r\n        $container.addClass('active').toggleClass('active-next', delta > 0).toggleClass('active-prev', delta < 0);\r\n\r\n        var frame = 0;\r\n        var step = 4;\r\n\r\n        function draw() {\r\n            requestAnimationFrame(function () {\r\n                if (frame > 100) {\r\n                    cleanPages();\r\n                    clean();\r\n                    shiftCurrent(delta);\r\n                    preloadImages();\r\n                    return;\r\n                }\r\n                setStage(corner, frame / 100);\r\n                frame += step;\r\n                refresh();\r\n                draw();\r\n            });\r\n        }\r\n\r\n        draw();\r\n    }\r\n\r\n    function preloadImages() {\r\n        preloadNextImages();\r\n        preloadPrevImages();\r\n    }\r\n\r\n    var preloaders = {};\r\n\r\n    function preloadImage($img) {\r\n        if (!$img.length) return;\r\n        var src = $img[0].src;\r\n        var img = new Image()\r\n        img.src = src;\r\n        img.onload = function () {\r\n            console.log(src);\r\n        }\r\n        preloaders[src] = img;\r\n    }\r\n\r\n    function preloadNextImages() {\r\n        var $current = $scaler.find('li.current');\r\n        for (var i = 0; i < 3; i++) {\r\n            var $current = $current.next('li');\r\n            var $img = $current.find('img');\r\n            preloadImage($img);\r\n        }\r\n    }\r\n\r\n    function preloadPrevImages() {\r\n        var $current = $scaler.find('li.current');\r\n        for (var i = 0; i < 3; i++) {\r\n            var $current = $current.prev('li');\r\n            var $img = $current.find('img');\r\n            var src = $img.attr('src');\r\n            preloadImage($img);\r\n        }\r\n    }\r\n\r\n    function animateFlipForward() {\r\n        var $newBase = $container.find('li.current').next('li').next('li');\r\n        if ($newBase.length) {\r\n            cleanPages();\r\n            $container.find('li.current').addClass('page1').next('li').addClass('page2').next('li').addClass('page3').next('li').addClass('page4');\r\n            animate('right', 2);\r\n        }\r\n    }\r\n\r\n    function animateFlipBackward() {\r\n        var $newBase = $container.find('li.current').prev('li').prev('li');\r\n        if ($newBase.length) {\r\n            cleanPages();\r\n            $container.find('li.current').next('li').addClass('page4').prev('li').addClass('page3').prev('li').addClass('page2').prev('li').addClass('page1');\r\n            animate('left', -2);\r\n        }\r\n    }\r\n\r\n    function animateForward() {\r\n        shiftCurrent(1);\r\n    }\r\n\r\n    function animateBackward() {\r\n        shiftCurrent(-1);\r\n    }\r\n\r\n    refresh();\r\n    preloadImages();\r\n\r\n    $('body').on('click', '.page-turn .nav-next-2', () => {\r\n        animateFlipForward();\r\n    }).on('click', '.page-turn .nav-prev-2', () => {\r\n        animateFlipBackward();\r\n    }).on('click', '.page-turn .nav-next', () => {\r\n        animateForward();\r\n    }).on('click', '.page-turn .nav-prev', () => {\r\n        animateBackward();\r\n    });\r\n\r\n});\r\n\r\n"],"sourceRoot":"/source/"}